{"version":3,"file":"app.js","sources":["../../src/attacher.js","../demo.js"],"sourcesContent":["/**\n * Attacher Styles\n */\nimport './attacher.scss';\n\n/**\n * @class Attacher\n */\nexport default class Attacher {\n  /**\n   * Pass arguments to class properties.\n   * @constructor\n   * @arg {Element} reference element.\n   * @arg {Element} target element.\n   * @arg {Boolean} debug mode.\n   * @arg {Float} transition seconds.\n   * @arg {Float} focusIndex\n   * @arg {String} posPriority (\"top\", \"bottom\", \"center\") of target.\n   * @arg {Object} padding of reference to target.\n   * @arg {Object} bPadding padding of boundary.\n   * @arg {Float} watchRefreshSeconds of attacher.\n   */\n  constructor(reference, {\n    target = null,\n    autoActivate = false,\n    debug = false,\n    styles: {\n      transition = 1,\n      focusIndex = 10,\n    } = {},\n    posPriority = 'bottom',\n    padding: {\n      x: paddingX = 10,\n      y: paddingY = 20,\n    } = {},\n    bPadding: {\n      x: bPaddingX = 25,\n      y: bPaddingY = 50,\n    } = {},\n    watchRefreshSeconds = .5,\n  }) {\n    if (debug) console.warn('attacher component created.', this);\n\n    /**\n     * Set up global properties.\n     */\n    this.reference = reference;\n    this.target = target;\n    this.debug = debug;\n    this.autoActivate = autoActivate;\n    this.focusIndex = focusIndex;\n    this.posPriority = posPriority;\n    this.transition = transition;\n    this.paddingX = paddingX;\n    this.paddingY = paddingY;\n    this.bPaddingX = bPaddingX;\n    this.bPaddingY = bPaddingY;\n    this.forcedPosPriority = false;\n    this.watchRefreshSeconds = watchRefreshSeconds;\n    this.windowWidth = window.innerWidth;\n\n    /**\n     * Bind reference to target if target exists.\n     */\n    if (target) this.bind(target);\n\n    this.watchBlurEvents();\n  }\n\n  /**\n   * Binds reference element to target element.\n   * @arg {Element} target could be a new target element.\n   */\n  bind(target) {\n    this.target = target;\n    this.setStyles();\n\n    if (this.autoActivate) {\n      setTimeout(() => {\n        this.activate(true);\n      }, 100);\n    }\n\n\n    if (this.debug) console.log(`Attacher bind method fired.`);\n  }\n\n  /**\n   * Unbinds reference element from target element.\n   */\n  unbind() {\n    if (this.debug) console.log(`Attacher unbind method fired.`);\n\n    this.resetStyles();\n    this.target = undefined;\n\n    this.deactivate();\n  }\n\n  /**\n   * Make reference visible. Start watching.\n   * @arg {Boolean} transition\n   */\n  activate(transition = false) {\n    this.switchFocus();\n    this.refresh();\n\n    if (transition) {\n      setTimeout(() => {\n        this.setTransitionStyle();\n      }, 100);\n    }\n\n    this.startWatch();\n  }\n\n  /**\n   * Make reference invisible. Stop watching.\n   */\n  deactivate() {\n    this.reference.style.transition = '';\n    this.reference.style.left = '';\n\n    this.stopWatch();\n  }\n\n  /**\n   * Switch focus function\n   */\n  switchFocus() {\n    document.dispatchEvent(new CustomEvent('blurAttacher'));\n    this.reference.style.zIndex = this.focusIndex;\n  }\n\n  /**\n   * Set up reference element's styles.\n   */\n  setStyles() {\n    this.reference.style.position = 'absolute';\n    this.reference.style.zIndex = 1;\n  }\n\n  /**\n   * Clear reference element's styles.\n   */\n  resetStyles() {\n    this.reference.style.position = '';\n    this.reference.style.zIndex = '';\n    this.reference.style.transition = '';\n    this.reference.style.left = '';\n    this.reference.style.top = '';\n  }\n\n  /**\n   * Set reference and content's default transition\n   * @arg {Element} reference\n   * @arg {Float} transition\n   */\n  setTransitionStyle(\n      reference = this.reference,\n      transition = this.transition,\n  ) {\n    reference.style.transition = `${transition}s`;\n  }\n\n  /**\n   * Unset reference and content's default transition\n   * @arg {Element} reference\n   * @arg {Element} content\n   */\n  unsetTransitionStyle(\n      reference = this.reference,\n      content = this.content,\n  ) {\n    reference.style.transition = '';\n  }\n\n  /**\n   * Refresh position of reference element.\n   * It is the function to reposition reference element.\n   */\n  refresh() {\n    if (this.target == undefined) {\n      if (this.debug) {\n        console.warn(`Attacher can't refresh. Target is undefined.`);\n      }\n      return;\n    }\n\n    this.setPosition(this.getPosition());\n  }\n\n  /**\n   * Decide new position according to window size and priority.\n   * @return {Object} new position of target element.\n   */\n  getPosition() {\n    const coords = this.target.getBoundingClientRect();\n    const positionX = this.offsetPositionX(coords.left + window.scrollX);\n    const positionY = this.offsetPositionY(coords.top + window.scrollY);\n    this.targetPosY = positionY;\n\n    return {\n      left: positionX,\n      top: positionY,\n    };\n  }\n\n  /**\n   * Set position of reference element.\n   * @arg {Object} position of reference element.\n   */\n  setPosition(position) {\n    this.reference.style.left = `${position.left}px`;\n    this.reference.style.top = `${position.top}px`;\n    this.reference.style.transform = '';\n  }\n\n  /**\n   * check if X axis is out of border.\n   * @arg {FLoat} position of target in x-axis.\n   * @return {Float} X distance between reference and target.\n   */\n  offsetPositionX(position) {\n    const newPosition = position - (this.reference.offsetWidth / 2) +\n    (this.target.offsetWidth / 2);\n\n    /**\n     * Check if reference is out-of-bounds.\n     */\n    const bodyWidth = window.innerWidth;\n\n    if (newPosition + this.reference.offsetWidth +\n      this.paddingX > bodyWidth) {\n      if (this.debug) console.log('Reference bleeds from right.');\n      return bodyWidth - this.reference.offsetWidth - this.paddingX;\n    }\n\n    if (newPosition - this.paddingX < 0) {\n      if (this.debug) console.log('Reference bleeds from left.');\n      return 0 + this.paddingX;\n    }\n\n    return newPosition;\n  }\n\n  /**\n   * Calculate Y distance first.\n   * Check if Y distance is out of boundary.\n   * If out of boundary. Recalculate Y distance.\n   * @arg {Float} position of target in y-axis.\n   * @return {Float} Y distance between reference and target.\n   */\n  offsetPositionY(position) {\n    let newPosition = this.repositionPivotY(position);\n\n    switch (this.checkBleedingY(newPosition)) {\n      case 'top':\n        newPosition = this.repositionPivotY(position, 'bottom');\n        break;\n\n      case 'bottom':\n        newPosition = this.repositionPivotY(position, 'top');\n        break;\n    }\n\n    return newPosition;\n  }\n\n  /**\n  * Calculate position priority of reference element.\n  * @arg {Float} position of target in y-axis.\n  * @arg {String} posPriority position priority.\n  * @return {Float} Y distance between reference and target.\n   */\n  repositionPivotY(position, posPriority = this.posPriority) {\n    let newPosition = 0;\n\n    switch (posPriority) {\n      case 'center':\n        newPosition = position;\n        break;\n\n      case 'top':\n        newPosition = position - this.reference.offsetHeight - this.paddingY;\n        break;\n\n      case 'bottom':\n        newPosition = position + this.target.offsetHeight + this.paddingY;\n        break;\n    }\n\n    return newPosition;\n  }\n\n  /**\n   * Check if target position is out-of-bounds in y-axis.\n   * @arg {Float} position of target in y-axis.\n   * @return {Boolean | String} the bleeding position of reference.\n   * false for no bleeding.\n   */\n  checkBleedingY(position) {\n    const topBoundary = window.scrollY;\n    const refTopBoundary = position - this.bPaddingY;\n\n    if (topBoundary >= refTopBoundary ) {\n      if (this.debug) console.log('Reference bleeds from top.');\n      this.forcedPosPriority = 'bottom';\n      return 'top';\n    }\n\n    const bottomBoundary = topBoundary + window.innerHeight;\n    const refBottomBoundary = position +\n    this.reference.offsetHeight + this.bPaddingY;\n\n    if (refBottomBoundary > bottomBoundary) {\n      if (this.debug) console.log('Reference bleeds from bottom.');\n      this.forcedPosPriority = 'top';\n      return 'bottom';\n    }\n\n    this.forcedPosPriority = false;\n\n    return false;\n  }\n\n  /**\n   * Watch Global Events\n   */\n  watchBlurEvents() {\n    document.addEventListener('blurAttacher', this.blurAttacher = () => {\n      this.reference.style.zIndex = 1;\n      if (this.debug) console.log('blurAttacher event fired.');\n    });\n  }\n\n  /**\n   * Listen document scroll change.\n   */\n  startWatch() {\n    /**\n     * Check if event listeners assigned.\n     */\n    if (this.eventListenersCreated) return;\n\n    /**\n     * Refresh reference element when the user scrolls the page.\n     */\n    document.addEventListener('scroll', this.scrollWatcher = () => {\n      if (!this.sleepMode) this.autoRefresh();\n      this.switchToSleepMode();\n    }, {passive: true});\n\n    /**\n     * Refresh when window object resized by the user.\n     */\n    window.addEventListener('resize', this.resizeWatcher = () => {\n      if (this.windowWidth == window.innerWidth) return;\n\n      if (this.debug) console.warn('Document resized.');\n\n      this.reference.style.display = 'none';\n      this.resetStyles();\n\n      setTimeout(() => {\n        this.reference.style.display = '';\n        this.setStyles();\n        this.refresh();\n      }, 100);\n\n      setTimeout(() => {\n        this.setTransitionStyle();\n      }, 200);\n\n      this.windowWidth = window.innerWidth;\n\n      if (this.debug) console.warn('new screen width set to default');\n    });\n\n    this.eventListenersCreated = true;\n\n    if (this.debug) console.warn('attacher started watching.');\n  }\n\n  /**\n   * Stop listening scroll and resize events.\n   */\n  stopWatch() {\n    document.removeEventListener('scroll', this.scrollWatcher);\n    window.removeEventListener('resize', this.resizeWatcher);\n\n    this.eventListenersCreated = false;\n\n    if (this.debug) console.warn('attacher stopped watching.');\n  }\n\n  /**\n   * Auto refreshes attacher on scroll event.\n   */\n  autoRefresh() {\n    if (this.checkBleedingTimer) return;\n\n    if (this.forcedPosPriority == this.checkBleedingY(this.targetPosY)) {\n      return;\n    };\n\n    if (this.debug) console.log('Refresh requested.');\n\n    setTimeout(() => {\n      this.checkBleedingTimer = false;\n      this.refresh();\n\n      if (this.debug) console.log('Refreshed.');\n    }, this.watchRefreshSeconds * 1000);\n\n    this.checkBleedingTimer = true;\n  }\n\n  /**\n   * Whether to switch sleep mode for watch.\n   */\n  switchToSleepMode() {\n    if (window.scrollY >\n      this.reference.offsetTop + this.reference.offsetHeight ||\n      this.reference.offsetTop > window.scrollY + window.innerHeight\n    ) {\n      if (this.debug && this.sleepMode == false) {\n        console.warn('attacher switched to sleep mode.');\n      }\n\n      this.sleepMode = true;\n\n      return;\n    }\n\n    if (this.debug && this.sleepMode == true) {\n      console.warn('attacher switched off sleep mode.');\n    }\n\n    this.sleepMode = false;\n  }\n};\n","/**\n * Import Styles\n */\nimport './demo.scss';\n\n/**\n * Import Main.js module\n */\nimport Attacher from '../src/attacher';\n\n/**\n * Get reference and target elements.\n */\nconst reference = document.querySelector('.reference--interactive');\nconst referenceSurface = document.querySelector('.reference-touch');\nconst targets = document.querySelectorAll('.target');\n\n/**\n * Create interactive attacher example. (Only for demonstration.)\n */\nconst attacher = new Attacher(reference, {\n  touchSurface: referenceSurface,\n  target: targets[0],\n  posPriority: 'top',\n  debug: true,\n  autoActivate: true,\n  styles: {\n    focusIndex: 10,\n  }\n});\n\n/**\n * Create static attacher example.\n */\n/* new Attacher(document.querySelector('.reference--static'), {\n  target: document.querySelector('.target--static'),\n  debug: true,\n}); */\n\n/**\n * Click and key events for debugging.\n */\nlet isVisible = true;\n\ndocument.addEventListener('keyup', (e) => {\n  e.preventDefault();\n\n  // Document reference bleeding test.\n  if (e.keyCode == 66) reference.classList.toggle('reference--bleed');\n\n  // Attacher activate/deactivate test.\n  if (e.keyCode == 32) {\n    isVisible ? attacher.deactivate() : attacher.activate();\n    isVisible = !isVisible;\n  }\n});\n\n// Unbind Attacher\nreference.addEventListener('click', (e) => {\n  /* attacher.unbind(); */\n});\n\n// Bind Attacher to clicked targets.\nlet i = 0; for (i; i < targets.length; i++) {\n  const target = targets[i];\n\n  target.addEventListener('click', (e) => {\n    e.preventDefault();\n    attacher.bind(e.target);\n  });\n}\n"],"names":["Attacher","reference","target","autoActivate","debug","styles","transition","focusIndex","posPriority","padding","x","paddingX","y","paddingY","bPadding","bPaddingX","bPaddingY","watchRefreshSeconds","console","warn","forcedPosPriority","windowWidth","window","innerWidth","bind","watchBlurEvents","setStyles","setTimeout","activate","log","resetStyles","undefined","deactivate","switchFocus","refresh","setTransitionStyle","startWatch","style","left","stopWatch","document","dispatchEvent","CustomEvent","zIndex","position","top","content","setPosition","getPosition","coords","getBoundingClientRect","positionX","offsetPositionX","scrollX","positionY","offsetPositionY","scrollY","targetPosY","transform","newPosition","offsetWidth","bodyWidth","repositionPivotY","checkBleedingY","offsetHeight","topBoundary","refTopBoundary","bottomBoundary","innerHeight","refBottomBoundary","addEventListener","blurAttacher","eventListenersCreated","scrollWatcher","sleepMode","autoRefresh","switchToSleepMode","passive","resizeWatcher","display","removeEventListener","checkBleedingTimer","offsetTop","querySelector","referenceSurface","targets","querySelectorAll","attacher","touchSurface","isVisible","e","preventDefault","keyCode","classList","toggle","i","length"],"mappings":"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"}
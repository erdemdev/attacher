{"version":3,"file":"app.js","sources":["../../src/attacher.js","../demo.js"],"sourcesContent":["/**\n * Attacher Styles\n */\nimport './attacher.scss';\n\n/**\n * @class Attacher\n */\nexport default class Attacher {\n  /**\n   * Pass arguments to class properties.\n   * @constructor\n   * @arg {Element} reference element.\n   * @arg {Element} target element.\n   * @arg {Boolean} debug mode.\n   * @arg {String} posPriority (\"top\", \"bottom\", \"center\") of target.\n   * @arg {Float} transition seconds.\n   * @arg {Object} padding of reference to target.\n   * @arg {Object} bPadding padding of boundary.\n   * @arg {Float} watchRefreshSeconds of attacher.\n   */\n  constructor(reference, {\n    target = null,\n    debug = false,\n    styles: {\n      transition = 1,\n    } = {},\n    posPriority = 'bottom',\n    padding: {\n      x: paddingX = 10,\n      y: paddingY = 20,\n    } = {},\n    bPadding: {\n      x: bPaddingX = 25,\n      y: bPaddingY = 50,\n    } = {},\n    watchRefreshSeconds = .5,\n  }) {\n    if (debug) console.warn('attacher component created.', this);\n\n    /**\n     * Set up global properties.\n     */\n    this.reference = reference;\n    this.target = target;\n    this.debug = debug;\n    this.posPriority = posPriority;\n    this.transition = transition;\n    this.paddingX = paddingX;\n    this.paddingY = paddingY;\n    this.bPaddingX = bPaddingX;\n    this.bPaddingY = bPaddingY;\n    this.forcedPosPriority = false;\n    this.watchRefreshSeconds = watchRefreshSeconds;\n    this.windowWidth = window.innerWidth;\n\n    /**\n     * Bind reference to target if target exists.\n     */\n    if (target) this.bind(target);\n  }\n\n  /**\n   * Binds reference element to target element.\n   * @arg {Element} target could be a new target element.\n   */\n  bind(target) {\n    this.target = target;\n    this.setStyles();\n    setTimeout(() => {\n      this.activate();\n    }, 100);\n    if (this.debug) console.log(`Attacher bind method fired.`);\n  }\n\n  /**\n   * Unbinds reference element from target element.\n   */\n  unbind() {\n    if (this.debug) console.log(`Attacher unbind method fired.`);\n    this.resetStyles();\n    this.target = undefined;\n    this.deactivate();\n  }\n\n  /**\n   * Make reference visible. Start watching.\n   */\n  activate() {\n    this.switchFocus();\n    this.refresh();\n    setTimeout(() => {\n      this.setTransitionStyle();\n    }, 100);\n    this.startWatch();\n  }\n\n  /**\n   * Make reference invisible. Stop watching.\n   */\n  deactivate() {\n    this.reference.style.transition = '';\n    this.reference.style.left = '-100%';\n    this.stopWatch();\n  }\n\n  /**\n   * Switch focus function\n   */\n  switchFocus() {\n    document.dispatchEvent(new CustomEvent('blurAttacher'));\n    this.reference.style.zIndex = 1000;\n  }\n\n  /**\n   * Set up reference element's styles.\n   */\n  setStyles() {\n    this.reference.style.position = 'absolute';\n    this.reference.style.zIndex = 1;\n  }\n\n  /**\n   * Clear reference element's styles.\n   */\n  resetStyles() {\n    this.reference.style.position = '';\n    this.reference.style.zIndex = '';\n    this.reference.style.transition = '';\n    this.reference.style.left = '';\n    this.reference.style.top = '';\n  }\n\n  /**\n   * Set reference and content's default transition\n   * @arg {Element} reference\n   * @arg {Float} transition\n   */\n  setTransitionStyle(\n      reference = this.reference,\n      transition = this.transition,\n  ) {\n    reference.style.transition = `${transition}s`;\n  }\n\n  /**\n   * Unset reference and content's default transition\n   * @arg {Element} reference\n   * @arg {Element} content\n   */\n  unsetTransitionStyle(\n      reference = this.reference,\n      content = this.content,\n  ) {\n    reference.style.transition = '';\n  }\n\n  /**\n   * Refresh position of reference element.\n   * It is the function to reposition reference element.\n   */\n  refresh() {\n    if (this.target == undefined) {\n      if (this.debug) {\n        console.warn(`Attacher can't refresh. Target is undefined.`);\n      }\n      return;\n    }\n\n    this.setPosition(this.getPosition());\n  }\n\n  /**\n   * Decide new position according to window size and priority.\n   * @return {Object} new position of target element.\n   */\n  getPosition() {\n    const coords = this.target.getBoundingClientRect();\n    const positionX = this.offsetPositionX(coords.left + window.scrollX);\n    const positionY = this.offsetPositionY(coords.top + window.scrollY);\n    this.targetPosY = positionY;\n\n    return {\n      left: positionX,\n      top: positionY,\n    };\n  }\n\n  /**\n   * Set position of reference element.\n   * @arg {Object} position of reference element.\n   */\n  setPosition(position) {\n    this.reference.style.left = `${position.left}px`;\n    this.reference.style.top = `${position.top}px`;\n    this.reference.style.transform = '';\n  }\n\n  /**\n   * check if X axis is out of border.\n   * @arg {FLoat} position of target in x-axis.\n   * @return {Float} X distance between reference and target.\n   */\n  offsetPositionX(position) {\n    const newPosition = position - (this.reference.offsetWidth / 2) +\n    (this.target.offsetWidth / 2);\n\n    /**\n     * Check if reference is out-of-bounds.\n     */\n    const bodyWidth = window.innerWidth;\n\n    if (newPosition + this.reference.offsetWidth +\n      this.paddingX > bodyWidth) {\n      if (this.debug) console.log('Reference bleeds from right.');\n      return bodyWidth - this.reference.offsetWidth - this.paddingX;\n    }\n\n    if (newPosition - this.paddingX < 0) {\n      if (this.debug) console.log('Reference bleeds from left.');\n      return 0 + this.paddingX;\n    }\n\n    return newPosition;\n  }\n\n  /**\n   * Calculate Y distance first.\n   * Check if Y distance is out of boundary.\n   * If out of boundary. Recalculate Y distance.\n   * @arg {Float} position of target in y-axis.\n   * @return {Float} Y distance between reference and target.\n   */\n  offsetPositionY(position) {\n    let newPosition = this.repositionPivotY(position);\n\n    switch (this.checkBleedingY(newPosition)) {\n      case 'top':\n        newPosition = this.repositionPivotY(position, 'bottom');\n        break;\n\n      case 'bottom':\n        newPosition = this.repositionPivotY(position, 'top');\n        break;\n    }\n\n    return newPosition;\n  }\n\n  /**\n  * Calculate position priority of reference element.\n  * @arg {Float} position of target in y-axis.\n  * @arg {String} posPriority position priority.\n  * @return {Float} Y distance between reference and target.\n   */\n  repositionPivotY(position, posPriority = this.posPriority) {\n    let newPosition = 0;\n\n    switch (posPriority) {\n      case 'center':\n        newPosition = position;\n        break;\n\n      case 'top':\n        newPosition = position - this.reference.offsetHeight - this.paddingY;\n        break;\n\n      case 'bottom':\n        newPosition = position + this.target.offsetHeight + this.paddingY;\n        break;\n    }\n\n    return newPosition;\n  }\n\n  /**\n   * Check if target position is out-of-bounds in y-axis.\n   * @arg {Float} position of target in y-axis.\n   * @return {Boolean | String} the bleeding position of reference.\n   * false for no bleeding.\n   */\n  checkBleedingY(position) {\n    const topBoundary = window.scrollY;\n    const refTopBoundary = position - this.bPaddingY;\n\n    if (topBoundary >= refTopBoundary ) {\n      if (this.debug) console.log('Reference bleeds from top.');\n      this.forcedPosPriority = 'bottom';\n      return 'top';\n    }\n\n    const bottomBoundary = topBoundary + window.innerHeight;\n    const refBottomBoundary = position +\n    this.reference.offsetHeight + this.bPaddingY;\n\n    if (refBottomBoundary > bottomBoundary) {\n      if (this.debug) console.log('Reference bleeds from bottom.');\n      this.forcedPosPriority = 'top';\n      return 'bottom';\n    }\n\n    this.forcedPosPriority = false;\n\n    return false;\n  }\n\n  /**\n   * Listen document scroll change.\n   */\n  startWatch() {\n    /**\n     * Check if event listeners assigned.\n     */\n    if (this.eventListenersCreated) return;\n\n    /**\n     * Refresh reference element when the user scrolls the page.\n     */\n    document.addEventListener('scroll', this.scrollWatcher = () => {\n      if (!this.sleepMode) this.autoRefresh();\n      this.switchToSleepMode();\n    }, {passive: true});\n\n    /**\n     * Refresh when window object resized by the user.\n     */\n    window.addEventListener('resize', this.resizeWatcher = () => {\n      if (this.windowWidth == window.innerWidth) return;\n\n      if (this.debug) console.warn('Document resized.');\n\n      this.reference.style.display = 'none';\n      this.resetStyles();\n\n      setTimeout(() => {\n        this.reference.style.display = '';\n        this.setStyles();\n        this.refresh();\n      }, 100);\n\n      setTimeout(() => {\n        this.setTransitionStyle();\n      }, 200);\n\n      this.windowWidth = window.innerWidth;\n\n      if (this.debug) console.log('new screen width set to default');\n    });\n\n    document.addEventListener('blurAttacher', this.blurAttacher = () => {\n      this.reference.style.zIndex = 1;\n      if (this.debug) console.log('blurAttacher event fired.');\n    });\n\n    this.eventListenersCreated = true;\n\n    if (this.debug) console.warn('attacher started watching.');\n  }\n\n  /**\n   * Stop listening scroll and resize events.\n   */\n  stopWatch() {\n    document.removeEventListener('scroll', this.scrollWatcher);\n    window.removeEventListener('resize', this.resizeWatcher);\n    document.removeEventListener('blurAttacher', this.blurAttacher);\n\n    this.eventListenersCreated = false;\n\n    if (this.debug) console.warn('attacher stopped watching.');\n  }\n\n  /**\n   * Auto refreshes attacher on scroll event.\n   */\n  autoRefresh() {\n    if (this.checkBleedingTimer) return;\n\n    if (this.forcedPosPriority == this.checkBleedingY(this.targetPosY)) {\n      return;\n    };\n\n    if (this.debug) console.log('Refresh requested.');\n\n    setTimeout(() => {\n      this.checkBleedingTimer = false;\n      this.refresh();\n      if (this.debug) console.log('Refreshed.');\n    }, this.watchRefreshSeconds * 1000);\n\n    this.checkBleedingTimer = true;\n  }\n\n  /**\n   * Whether to switch sleep mode for watch.\n   */\n  switchToSleepMode() {\n    if (window.scrollY >\n      this.reference.offsetTop + this.reference.offsetHeight ||\n      this.reference.offsetTop > window.scrollY + window.innerHeight\n    ) {\n      if (this.debug && this.sleepMode == false) {\n        console.warn('attacher switched to sleep mode.');\n      }\n      this.sleepMode = true;\n      return;\n    }\n\n    if (this.debug && this.sleepMode == true) {\n      console.warn('attacher switched off sleep mode.');\n    }\n\n    this.sleepMode = false;\n  }\n};\n","/**\n * Import Styles\n */\nimport './demo.scss';\n\n/**\n * Import Main.js module\n */\nimport Attacher from '../src/attacher';\n\n/**\n * Get reference and target elements.\n */\nconst reference = document.querySelector('.reference--interactive');\nconst referenceSurface = document.querySelector('.reference-touch');\nconst targets = document.querySelectorAll('.target');\n\n/**\n * Create interactive attacher example. (Only for demonstration.)\n */\nconst attacher = new Attacher(reference, {\n  touchSurface: referenceSurface,\n  target: targets[0],\n  posPriority: 'top',\n  debug: true,\n});\n\n/**\n * Create static attacher example.\n */\n/* new Attacher(document.querySelector('.reference--static'), {\n  target: document.querySelector('.target--static'),\n  debug: true,\n}); */\n\n/**\n * Click and key events for debugging.\n */\nlet isVisible = true;\n\ndocument.addEventListener('keyup', (e) => {\n  e.preventDefault();\n\n  // Document reference bleeding test.\n  if (e.keyCode == 66) reference.classList.toggle('reference--bleed');\n\n  // Attacher activate/deactivate test.\n  if (e.keyCode == 32) {\n    isVisible ? attacher.deactivate() : attacher.activate();\n    isVisible = !isVisible;\n  }\n});\n\n// Unbind Attacher\nreference.addEventListener('click', (e) => {\n  /* attacher.unbind(); */\n});\n\n// Bind Attacher to clicked targets.\nlet i = 0; for (i; i < targets.length; i++) {\n  const target = targets[i];\n\n  target.addEventListener('click', (e) => {\n    e.preventDefault();\n    attacher.bind(e.target);\n  });\n}\n"],"names":["Attacher","reference","target","debug","styles","transition","posPriority","padding","x","paddingX","y","paddingY","bPadding","bPaddingX","bPaddingY","watchRefreshSeconds","console","warn","forcedPosPriority","windowWidth","window","innerWidth","bind","setStyles","setTimeout","activate","log","resetStyles","undefined","deactivate","switchFocus","refresh","setTransitionStyle","startWatch","style","left","stopWatch","document","dispatchEvent","CustomEvent","zIndex","position","top","content","setPosition","getPosition","coords","getBoundingClientRect","positionX","offsetPositionX","scrollX","positionY","offsetPositionY","scrollY","targetPosY","transform","newPosition","offsetWidth","bodyWidth","repositionPivotY","checkBleedingY","offsetHeight","topBoundary","refTopBoundary","bottomBoundary","innerHeight","refBottomBoundary","eventListenersCreated","addEventListener","scrollWatcher","sleepMode","autoRefresh","switchToSleepMode","passive","resizeWatcher","display","blurAttacher","removeEventListener","checkBleedingTimer","offsetTop","querySelector","referenceSurface","targets","querySelectorAll","attacher","touchSurface","isVisible","e","preventDefault","keyCode","classList","toggle","i","length"],"mappings":"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"}
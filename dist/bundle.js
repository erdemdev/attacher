"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var Attacher=function(){function p(e,t){var i=t.target,o=void 0===i?void 0:i,s=t.debug,r=void 0!==s&&s,n=t.posPriority,c=void 0===n?"top":n,h=t.transition,f=void 0===h?1:h,a=t.offset,d=void 0===a?{left:0,top:10}:a,l=t.bPadding,u=void 0===l?{left:20,top:50}:l,g=t.refreshSeconds,b=void 0===g?.2:g;_classCallCheck(this,p),this.reference=e,this.target=o,this.debug=r,this.posPriority=c,this.transition=f,this.offset=d,this.bPadding=u,this.forcedPosPriority=!1,this.refreshTimer=null,this.refreshSeconds=b,this.init(),o&&this.bind(o)}return _createClass(p,[{key:"init",value:function(){this.reference.style.position="absolute",this.reference.style.zIndex=1,this.reference.style.left=0,this.reference.style.bottom=0,this.debug&&console.log("attacher component created.",this)}},{key:"bind",value:function(e){var t=this;this.target=e,this.refresh(),setTimeout(function(){t.reference.style.transition="".concat(t.transition,"s")},10),this.startWatch(),this.debug&&console.log("Attacher bind method fired. ",this)}},{key:"unbind",value:function(){this.reference.style.transition="",this.reference.style.left="0",this.reference.style.top="0",this.target=void 0,this.stopWatch(),this.debug&&console.log("Attacher unbind method fired. ",this)}},{key:"refresh",value:function(){null!=this.target?this.setPosition(this.getPosition()):this.debug&&console.warn("Attacher can't refresh. Target is undefined.")}},{key:"startWatch",value:function(){var t=this;document.addEventListener("scroll",this.scrollWatcher=function(e){t.forcedPosPriority!=t.checkBleedingY(t.targetPosY)&&(t.debug&&console.warn("Refresh requested."),clearTimeout(t.refreshTimer),t.refreshTimer=setTimeout(function(){t.refresh(),t.debug&&console.warn("Refreshed.")},1e3*t.refreshSeconds))},{passive:!0}),window.addEventListener("resize",this.resizeWatcher=function(){t.reference.style.display="none",setTimeout(function(){t.reference.style.display="",t.refresh(),t.debug&&console.warn("Document resized.")},10)}),this.debug&&console.warn("attacher started watching.")}},{key:"stopWatch",value:function(){document.removeEventListener("scroll",this.scrollWatcher),window.removeEventListener("resize",this.resizeWatcher),this.debug&&console.warn("attacher stopped watching.")}},{key:"getPosition",value:function(){var e=this.target.getBoundingClientRect(),t=this.offsetPositionX(e.left+document.body.scrollLeft),i=this.offsetPositionY(e.top+document.body.scrollTop);return{left:t,top:this.targetPosY=i}}},{key:"setPosition",value:function(e){this.reference.style.left="".concat(e.left,"px"),this.reference.style.top="".concat(e.top,"px")}},{key:"offsetPositionX",value:function(e){var t=e-this.reference.offsetWidth/2+this.target.offsetWidth/2,i=document.body.clientWidth;return t+this.reference.offsetWidth+this.bPadding.left>i?(this.debug&&console.warn("Reference bleeds from right."),i-this.reference.offsetWidth-this.bPadding.left):t-this.bPadding.left<0?(this.debug&&console.warn("Reference bleeds from left."),0+this.bPadding.left):t}},{key:"offsetPositionY",value:function(e){var t=this.repositionPivotY(e);switch(this.checkBleedingY(t)){case"top":t=this.repositionPivotY(e,"bottom");break;case"bottom":t=this.repositionPivotY(e,"top")}return t}},{key:"repositionPivotY",value:function(e,t){var i=0;switch(1<arguments.length&&void 0!==t?t:this.posPriority){case"center":i=e;break;case"top":i=e-this.reference.offsetHeight-this.offset.top;break;case"bottom":i=e+this.target.offsetHeight+this.offset.top}return i}},{key:"checkBleedingY",value:function(e){var t=document.body.scrollTop;return e-this.bPadding.top<=t?(this.debug&&console.warn("Reference bleeds from top."),this.forcedPosPriority="bottom","top"):t+document.body.clientHeight<e+this.reference.offsetHeight+this.bPadding.top?(this.debug&&console.warn("Reference bleeds from bottom."),this.forcedPosPriority="top","bottom"):this.forcedPosPriority=!1}}]),p}();module.exports=Attacher;
